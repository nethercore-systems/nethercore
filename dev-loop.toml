# Dev Loop Configuration
# Autonomous development loop powered by Claude Code

[general]
# Path to your tasks file (relative to project root)
tasks_file = "TASKS.md"

# Path to the log file
log_file = "dev-loop.log"

# Command to run your tests
# Examples: "pytest", "npm test", "go test ./...", "make test"
test_command = "cargo test"

# Maximum tasks to process in one run (safety limit)
max_tasks = 1000

# Seconds to pause between tasks
delay_between_tasks = 2


[git]
# Branch name for autonomous work (main stays clean)
dev_branch = "auto/dev"

# Create checkpoint tags for easy rollback
create_checkpoints = true

# Tag every N successful tasks
checkpoint_interval = 25


[tasks]
# Max retries per task before skipping
max_attempts = 3

# Prefix for stability/maintenance tasks
stability_prefix = "[STABILITY]"

# Automatically attempt to fix failing tests at startup (instead of requiring manual fix)
auto_fix_on_start = true


[review]
# Enable periodic stability reviews
enabled = true

# Run review every N completed tasks
interval = 15

# Categories to check during review
categories = [
    "test_coverage",
    "error_handling",
    "documentation",
    "code_quality",
    "refactoring",
    "todos",
]

# Optional: custom review prompt (overrides default)
# custom_prompt = "Your custom review instructions here..."


[docs]
# Enable periodic documentation improvement passes
enabled = false

# Run docs pass every N completed tasks
interval = 10

# Optional: custom docs prompt (overrides default)
# custom_prompt = "Your custom docs instructions here..."


[refactor]
# Enable periodic code refactoring passes
enabled = false

# Run refactor pass every N completed tasks
interval = 10

# Optional: custom refactor prompt (overrides default)
# custom_prompt = "Your custom refactor instructions here..."


[discovery]
# Auto-generate new tasks when backlog is empty
enabled = false

# Maximum tasks to generate per discovery run
max_generated_tasks = 10

# Pause for human approval before adding tasks (safer but not autonomous)
require_approval = false

# Show desktop notification + sound when approval is needed
notify_on_approval = true

# What to look for when discovering tasks
categories = ["features", "improvements", "maintenance", "testing"]

# Seconds to wait before re-discovering (prevents busy loop)
cooldown_after_empty = 300


[claude]
# Extra flags to pass to claude CLI (e.g., ["--model", "opus"])
extra_flags = ["--model", "sonnet"]

# Skip permission prompts for autonomous operation (required for unattended runs)
auto_approve = true

# Use --continue flag when retrying failed tasks (saves tokens by maintaining context)
continue_on_retry = true

# Experimental: maintain session across different tasks (can save tokens but may accumulate stale context)
maintain_session = false


[usage]
# Enable usage limit checking (prevents consuming entire Claude Code allowance)
enabled = true

# Maximum percentage of 5-hour rolling limit before pausing (0-100)
# Leave headroom for manual Claude Code usage
max_5h_percent = 90

# Maximum percentage of weekly limit before pausing (0-100)
max_weekly_percent = 90

# Check usage every N completed tasks
check_interval = 3

# Seconds to wait when limit is hit before rechecking
pause_duration = 300

# Exit instead of pausing when limit is hit (set to true if running as a service)
exit_on_limit = false


[model_tiering]
# Enable smart model selection based on task complexity (reduces token usage)
enabled = true

# Model for simple tasks (docs, typos, config changes)
# Examples: "haiku", "claude-3-haiku-20240307"
simple_model = "sonnet"

# Model for standard tasks (uses default if not set)
standard_model = "sonnet"

# Upgrade to standard model after N failures with simple model
# Set to 1 for immediate upgrade on first failure (safest)
upgrade_after_failures = 1

# Task prefixes that force simple model classification
# Useful for manually marking tasks you know are simple
simple_prefixes = ["[SIMPLE]", "[DOCS]", "[TYPO]", "[CONFIG]"]
